# 要件定義書

## はじめに

本機能は、学習管理システム（LMS）において、学習者がメイン教材（URL型教材や外部学習教材）の進捗率を手動で記入・管理できる機能を提供します。これにより、外部サイトやYouTube動画など、システム外で実施した学習活動の進捗を学習者自身が記録し、包括的な学習進捗管理を実現します。

本機能は、プロダクト概要に記載されている「手動進捗管理：外部学習の進捗率を学習者が入力」というコア機能を実装するものです。

## 要件

### 要件1: メイン教材への進捗率入力機能
**目的:** 学習者として、メイン教材の学習進捗率を手動で入力したい。これにより、外部学習活動の進捗を記録・管理できる。

#### 受け入れ基準

1. WHEN 学習者がメイン教材の詳細画面を表示する THEN システムは現在の進捗率（0-100%）を表示する
2. WHEN 学習者が進捗率入力フォームを開く THEN システムは0から100までの数値入力フィールドを提供する
3. WHEN 学習者が有効な進捗率（0-100の整数）を入力して保存する THEN システムは進捗率を更新し成功メッセージを表示する
4. IF 学習者が範囲外の値（0未満または100超過）を入力する THEN システムはエラーメッセージを表示し保存を拒否する
5. IF 学習者が数値以外の値を入力する THEN システムはバリデーションエラーを表示し保存を拒否する
6. WHEN 学習者が進捗率を100%に設定する THEN システムは教材を「完了」ステータスに更新する
7. WHEN 学習者が完了済み教材の進捗率を100%未満に変更する THEN システムは教材を「進行中」ステータスに戻す

### 要件2: 進捗率の履歴管理
**目的:** 学習者として、過去の進捗率変更履歴を確認したい。これにより、学習の振り返りと成長の可視化ができる。

#### 受け入れ基準

1. WHEN 学習者が進捗率を更新する THEN システムは更新日時と進捗率を履歴として記録する
2. WHEN 学習者が進捗履歴を表示する THEN システムは日時の新しい順に履歴を表示する
3. WHERE 進捗履歴表示画面 THE システムは各履歴エントリに「日時」「進捗率」「変更差分」を表示する
4. IF 進捗履歴が存在しない THEN システムは「まだ進捗の記録がありません」というメッセージを表示する

### 要件3: 進捗率の自動反映と集計
**目的:** 学習者として、メイン教材の進捗率が全体の学習進捗に自動的に反映されることを期待する。これにより、包括的な進捗管理が可能になる。

#### 受け入れ基準

1. WHEN 学習者がメイン教材の進捗率を更新する THEN システムはレッスン全体の進捗率を自動再計算する
2. WHEN レッスン内の全教材（自動追跡教材+手動入力教材）の進捗が更新される THEN システムはレッスンの総合進捗率を計算する
3. WHERE 学習進捗ダッシュボード THE システムは手動入力した教材の進捗を他の教材進捗と統合して表示する
4. WHEN レッスンの進捗率が更新される THEN システムはコース全体の進捗率も自動更新する

### 要件4: UI/UX要件
**目的:** 学習者として、直感的で使いやすい進捗率入力インターフェースを利用したい。これにより、ストレスなく進捗を記録できる。

#### 受け入れ基準

1. WHERE 教材詳細画面 THE システムは進捗率を視覚的に表現するプログレスバーを表示する
2. WHEN 学習者が進捗率入力フォームを操作する THEN システムはリアルタイムでプログレスバーのプレビューを更新する
3. WHERE 進捗率入力フォーム THE システムは「0%」「25%」「50%」「75%」「100%」のクイック選択ボタンを提供する
4. WHEN 学習者がクイック選択ボタンをクリックする THEN システムは即座に該当する進捗率を入力フィールドに設定する
5. WHERE モバイル画面 THE システムは数値入力にモバイル最適化されたキーパッド入力を提供する

### 要件5: 通知とフィードバック
**目的:** 学習者として、進捗率更新時に適切なフィードバックを受け取りたい。これにより、操作の成功/失敗を明確に認識できる。

#### 受け入れ基準

1. WHEN 学習者が進捗率を正常に更新する THEN システムは「進捗率を更新しました」という成功通知を3秒間表示する
2. WHEN 学習者が教材を完了（100%）にする THEN システムは「おめでとうございます！教材を完了しました」という祝福メッセージを表示する
3. IF 進捗率の保存中にエラーが発生する THEN システムはエラーの原因を説明するメッセージを表示する
4. WHEN ネットワークエラーで保存に失敗する THEN システムは再試行オプションを提供する

### 要件6: データ整合性とバリデーション
**目的:** システムとして、進捗率データの整合性と正確性を保証したい。これにより、信頼性の高い学習データを維持できる。

#### 受け入れ基準

1. WHEN 学習者が進捗率を送信する THEN システムはバックエンドで再度バリデーションを実施する
2. IF 同時に複数の進捗率更新リクエストが発生する THEN システムは最新のリクエストのみを適用する
3. WHEN 学習者が認証セッション外で進捗率を更新しようとする THEN システムは認証エラーを返す
4. WHERE データベース THE システムは進捗率を0-100の整数として格納する
5. WHEN 学習者が他のユーザーの教材進捗を更新しようとする THEN システムは権限エラーを返す

### 要件7: パフォーマンス要件
**目的:** システムとして、進捗率更新操作を高速に処理したい。これにより、スムーズなユーザー体験を提供できる。

#### 受け入れ基準

1. WHEN 学習者が進捗率を保存する THEN システムは3秒以内にレスポンスを返す
2. WHEN 進捗率が更新される THEN システムは5秒以内にダッシュボードの集計データを更新する
3. WHERE 高負荷時（500名の同時アクセス） THE システムは進捗率更新リクエストを10秒以内に処理する
