# 要件定義書

## はじめに

学習管理システム（LMS）では、レッスンコンテンツを様々な形式で提供しています。現在、レッスンの`content`フィールドはHTMLとして表示されていますが、マークダウン記法で記述されたコンテンツを適切にレンダリングして表示する機能が求められています。

この機能により、教育者は読みやすいマークダウン形式でコンテンツを作成でき、学習者は見やすくフォーマットされたコンテンツを閲覧できるようになります。

## 要件

### 要件1: マークダウンコンテンツの判定と表示

**目的:** コース管理者として、レッスンコンテンツがマークダウン記法で記述されている場合、学習者に対して適切にレンダリングされたビューワー表示を提供したい。これにより、読みやすく構造化されたコンテンツを提供できる。

#### 受入基準

1. WHEN レッスン詳細ページ(LessonDetail)が読み込まれ、AND レッスンのcontentフィールドにマークダウン記法のコンテンツが含まれている THEN システム SHALL マークダウンをHTMLに変換してレンダリングする
2. WHEN レッスンのcontentフィールドがマークダウン形式である THEN システム SHALL 見出し(h1-h6)、リスト、コードブロック、リンク、画像、テーブル、引用などの標準マークダウン構文を正しく表示する
3. WHEN マークダウンコンテンツにコードブロックが含まれている THEN システム SHALL プログラミング言語に応じたシンタックスハイライトを適用する
4. IF レッスンのcontentフィールドが空またはnullである THEN システム SHALL 既存の「コンテンツなし」メッセージを表示する

### 要件2: セキュアなマークダウンレンダリング

**目的:** システム管理者として、マークダウンコンテンツをレンダリングする際にXSS攻撃などのセキュリティリスクから保護したい。これにより、安全なコンテンツ配信を実現できる。

#### 受入基準

1. WHEN マークダウンをHTMLに変換する THEN システム SHALL 悪意のあるスクリプトやHTMLタグをサニタイズする
2. WHEN マークダウンに外部リンクが含まれている THEN システム SHALL リンクに`rel="noopener noreferrer"`属性を自動付与する
3. WHEN マークダウンに画像が含まれている THEN システム SHALL 画像の読み込みエラーを適切にハンドリングする

### 要件3: レスポンシブなマークダウン表示

**目的:** 学習者として、デスクトップ、タブレット、モバイルなど様々なデバイスでマークダウンコンテンツを快適に閲覧したい。これにより、どこでも学習を継続できる。

#### 受入基準

1. WHEN マークダウンコンテンツが表示される THEN システム SHALL 画面幅に応じて適切にレイアウトを調整する
2. WHEN モバイルデバイスでコードブロックが表示される THEN システム SHALL 横スクロールを提供し、コード全体を閲覧可能にする
3. WHEN テーブルが含まれている THEN システム SHALL モバイルデバイスでも読みやすい表示を提供する

### 要件4: マークダウンプレビュー機能（管理者向け）

**目的:** コース管理者として、レッスンフォーム(LessonForm)でマークダウンコンテンツを編集する際に、リアルタイムプレビューを確認したい。これにより、公開前にコンテンツの見た目を確認できる。

#### 受入基準

1. WHEN レッスンフォームでcontentフィールドを編集している THEN システム SHALL 編集エリアとプレビューエリアを並べて表示する
2. WHEN contentフィールドにマークダウンを入力する THEN システム SHALL リアルタイムでレンダリング結果をプレビューエリアに表示する
3. WHEN プレビューエリアが表示されている THEN システム SHALL 学習者が見るのと同じスタイルでコンテンツをレンダリングする

### 要件5: マークダウン記法のヘルプ機能

**目的:** コース管理者として、マークダウン記法の書き方を簡単に参照できるヘルプ機能がほしい。これにより、効率的にコンテンツを作成できる。

#### 受入基準

1. WHEN レッスンフォームのcontentフィールドにフォーカスがある THEN システム SHALL マークダウン記法ヘルプボタンまたはリンクを表示する
2. WHEN マークダウン記法ヘルプを開く THEN システム SHALL 見出し、リスト、コードブロック、リンク、画像などの基本的な構文例を表示する
3. WHEN ヘルプモーダルまたはポップオーバーが表示されている THEN システム SHALL 構文例をクリックして編集エリアに挿入できる機能を提供する

### 要件6: パフォーマンスとアクセシビリティ

**目的:** システム全体として、マークダウンレンダリング機能が高速で、かつアクセシブルであることを保証したい。これにより、すべての学習者に快適な学習体験を提供できる。

#### 受入基準

1. WHEN レッスン詳細ページが読み込まれる THEN システム SHALL マークダウンのレンダリングを3秒以内に完了する
2. WHEN マークダウンコンテンツがレンダリングされる THEN システム SHALL 適切なセマンティックHTML要素を使用する
3. WHEN マークダウンに画像が含まれている THEN システム SHALL alt属性を保持または提供する
4. WHEN コードブロックが表示される THEN システム SHALL スクリーンリーダーでコード内容を読み上げ可能にする
